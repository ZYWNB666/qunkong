# Qunkong 运维管理平台使用说明

## 项目概述

Qunkong是一个基于Vue 3 + Element Plus的现代化运维管理平台，提供脚本执行、执行历史和Agent管理功能。前端采用现代化的UI设计，完全参考了 https://queenbee.gre.garenanow.com/93/execute/script 的设计风格。

## 功能模块

### 1. 脚本执行 🚀

**功能特点:**
- 支持Shell和Python脚本编写
- 实时脚本编辑器，带行号显示
- 多服务器批量执行
- 脚本参数化支持
- 超时时间控制
- 执行账号选择

**使用步骤:**
1. 输入脚本名称（便于后续查找）
2. 选择脚本来源（手工录入/脚本引用）
3. 在编辑器中编写脚本内容
4. 设置脚本参数（可选）
5. 配置超时时间
6. 选择执行账号
7. 添加目标服务器
8. 点击"执行"按钮

**支持的脚本类型:**
- **Shell脚本**: 提供完整的Bash环境
- **Python脚本**: 支持Python 3.x

### 2. 执行历史 📊

**功能特点:**
- 任务执行记录查看
- 实时状态监控
- 详细执行结果展示
- 任务重试和停止
- 多维度筛选和搜索
- 分页显示

**筛选功能:**
- 按任务类型筛选
- 关键词搜索（任务ID、名称、执行人、状态）
- 时间范围筛选
- 状态排序

**任务状态:**
- **等待中** (PENDING): 任务已创建，等待执行
- **执行中** (RUNNING): 任务正在执行
- **成功** (SUCCEED): 任务执行成功
- **失败** (FAILED): 任务执行失败

### 3. Agent管理 🖥️

**功能特点:**
- Agent状态实时监控
- 系统信息详细查看
- 批量操作管理
- 版本更新控制
- 执行历史追踪

**Agent状态:**
- **在线** (ONLINE): Agent正常运行
- **离线** (OFFLINE): Agent连接断开

**操作功能:**
- 查看Agent详情
- 重启Agent服务
- 更新Agent版本
- 查看执行日志
- 配置管理

## 快速开始

### 环境准备

1. **Node.js环境**
   - 版本要求: Node.js >= 16.0.0
   - 下载地址: https://nodejs.org/

2. **Python环境**（后端）
   - 版本要求: Python >= 3.7
   - 依赖包: flask, websockets

### 安装和启动

#### 方法一: 使用启动脚本（推荐）

**Windows用户:**
```bash
# 启动前端
start.bat

# 启动后端（新终端窗口）
python start_backend.py
```

**Linux/Mac用户:**
```bash
# 启动前端
./start.sh

# 启动后端（新终端窗口）
python3 start_backend.py
```

#### 方法二: 手动启动

**启动前端:**
```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev
```

**启动后端:**
```bash
# 安装Python依赖
pip install flask websockets

# 启动后端服务
python app/main.py
# 或者
python bak/server.py
```

### 访问地址

- **前端地址**: http://localhost:3000
- **后端API**: http://localhost:5000
- **WebSocket**: ws://localhost:8765

## 使用指南

### 脚本执行流程

1. **创建脚本任务**
   - 在"脚本执行"页面填写任务信息
   - 编写或粘贴脚本内容
   - 选择目标服务器

2. **监控执行状态**
   - 在"执行历史"页面查看任务状态
   - 实时监控执行进度
   - 查看执行结果

3. **管理Agent**
   - 在"Agent管理"页面查看Agent状态
   - 管理Agent生命周期
   - 查看系统信息

### 高级功能

#### 脚本参数化
```bash
# Shell脚本示例
#!/bin/bash
echo "参数1: $1"
echo "参数2: $2"
echo "参数3: $3"
```

在脚本参数框中输入: `arg1 arg2 arg3`

#### 批量操作
- 在Agent管理页面选择多个Agent
- 点击"批量管理"按钮
- 选择操作类型（重启、更新、停止）
- 执行批量操作

#### 任务重试
- 在执行历史页面找到失败的任务
- 点击"重试"按钮
- 系统将使用相同参数重新执行

## 故障排除

### 常见问题

**1. 前端无法启动**
- 检查Node.js版本是否 >= 16.0.0
- 删除node_modules文件夹，重新运行npm install
- 检查端口3000是否被占用

**2. 后端无法启动**
- 检查Python版本是否 >= 3.7
- 安装必要的依赖包: `pip install flask websockets`
- 检查端口5000和8765是否被占用

**3. API请求失败**
- 确认后端服务正在运行
- 检查代理配置是否正确
- 查看浏览器控制台错误信息

**4. Agent连接失败**
- 检查Agent是否正常启动
- 确认网络连接正常
- 查看Agent日志文件

### 日志查看

**前端日志:**
- 打开浏览器开发者工具
- 查看Console面板

**后端日志:**
- 查看终端输出
- 检查应用日志文件

## 开发指南

### 项目结构
```
qunkong-frontend/
├── public/                 # 静态资源
├── src/
│   ├── api/               # API接口
│   ├── router/            # 路由配置
│   ├── views/             # 页面组件
│   ├── App.vue            # 根组件
│   └── main.js            # 入口文件
├── package.json           # 项目配置
├── vite.config.js         # Vite配置
└── README.md              # 项目说明
```

### 添加新功能

1. **创建新页面**
   - 在`src/views/`目录下创建Vue组件
   - 在`src/router/index.js`中添加路由
   - 在`src/App.vue`中添加菜单项

2. **添加新API**
   - 在`src/api/index.js`中定义API函数
   - 在组件中导入并使用

3. **自定义样式**
   - 使用Element Plus组件
   - 遵循BEM命名规范
   - 保持响应式设计

## 技术支持

如有问题，请检查以下内容：

1. 环境配置是否正确
2. 依赖包是否完整安装
3. 端口是否被占用
4. 网络连接是否正常

## 更新日志

### v1.0.0 (2024-01-XX)
- 初始版本发布
- 实现脚本执行功能
- 实现执行历史功能
- 实现Agent管理功能
- 现代化UI设计
