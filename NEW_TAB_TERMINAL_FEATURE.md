# 新标签页终端功能说明

## 功能概述

现在终端可以在新的浏览器标签页中打开，提供更好的用户体验和更大的操作空间。

## 主要改进

### 🆕 新功能

1. **独立终端页面** (`/src/views/Terminal.vue`)
   - 全屏终端体验
   - 独立的页面路由 `/terminal/:agentId`
   - 更大的终端窗口和更好的可视性

2. **增强的用户界面**
   - 专业的终端主题（深色背景）
   - 更大的字体（16px vs 14px）
   - 更多的滚动缓冲区（5000行 vs 1000行）
   - 响应式设计，适配不同屏幕尺寸

3. **改进的功能**
   - 详细的帮助文档和快捷键说明
   - 连接状态的可视化反馈
   - 自动重连功能
   - 窗口关闭前的确认提示

### 🔧 技术改进

1. **路由配置**
   ```javascript
   {
     path: '/terminal/:agentId',
     name: 'Terminal',
     component: Terminal,
     meta: { requiresAuth: true }
   }
   ```

2. **URL参数传递**
   ```javascript
   const terminalUrl = `/terminal/${agent.id}?hostname=${encodeURIComponent(agent.hostname)}&ip=${encodeURIComponent(agent.ip)}`
   window.open(terminalUrl, '_blank', 'noopener,noreferrer')
   ```

3. **页面标题动态设置**
   ```javascript
   document.title = `Terminal - ${hostname} - Qunkong`
   ```

## 使用方法

### 打开终端

1. 在Agent管理页面，点击任意在线Agent的"终端"按钮
2. 系统会在新的浏览器标签页中打开终端
3. 终端会自动连接到指定的Agent

### 终端操作

#### 基本操作
- **Enter** - 执行命令
- **↑/↓** - 浏览历史命令
- **Ctrl+C** - 中断当前命令
- **Ctrl+D** - 发送EOF信号
- **exit** 或 **logout** - 退出会话

#### 快捷键
- **Ctrl+L** - 清屏（等同于clear命令）
- **Tab** - 自动补全
- **Ctrl+A** - 光标移到行首
- **Ctrl+E** - 光标移到行尾
- **Ctrl+U** - 删除光标前的内容
- **Ctrl+K** - 删除光标后的内容

#### 界面操作
- **清屏按钮** - 清除终端显示内容
- **帮助按钮** - 显示/隐藏使用说明
- **重连按钮** - 重新建立连接
- **关闭按钮** - 关闭终端（会有确认提示）

## 安全特性

1. **白名单命令** - 仅允许执行预定义的安全命令
2. **操作审计** - 所有命令执行都会被记录
3. **超时保护** - 命令执行有30秒超时限制
4. **权限控制** - 需要登录认证才能访问

## 技术特性

### WebSocket连接
- 实时双向通信
- 自动重连机制
- 连接状态监控
- 心跳保活

### 终端特性
- 基于xterm.js的专业终端模拟器
- 支持ANSI颜色和控制序列
- 可调整大小的终端窗口
- 鼠标选择和复制功能

### 响应式设计
- 适配桌面和移动设备
- 自动调整终端大小
- 触摸友好的界面

## 兼容性

- **浏览器支持**: Chrome 60+, Firefox 55+, Safari 12+, Edge 79+
- **WebSocket**: 需要浏览器支持WebSocket协议
- **弹窗阻止**: 需要允许弹窗才能正常打开新标签页

## 故障排除

### 常见问题

1. **终端无法打开**
   - 检查浏览器是否阻止了弹窗
   - 确认Agent状态为在线
   - 检查网络连接

2. **连接失败**
   - 检查WebSocket连接
   - 确认服务器端口开放
   - 尝试重新连接

3. **命令无响应**
   - 检查命令是否在白名单中
   - 等待命令执行完成（最长30秒）
   - 使用Ctrl+C中断当前命令

### 调试信息

终端页面提供详细的调试信息：
- 浏览器控制台中的连接日志
- 实时的连接状态显示
- 错误消息的可视化反馈

## 后续计划

1. **多标签支持** - 支持同时打开多个Agent的终端
2. **会话保持** - 页面刷新后恢复终端会话
3. **文件传输** - 支持文件上传下载
4. **终端录制** - 记录终端会话用于回放
5. **协作功能** - 支持多用户共享终端会话

这个新的终端功能大大提升了用户体验，提供了更专业和便捷的服务器管理方式。
