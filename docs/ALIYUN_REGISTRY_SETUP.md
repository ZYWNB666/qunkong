# é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡é…ç½®æŒ‡å—

## ğŸ”§ å¿…é¡»å®Œæˆï¼šåˆ›å»ºé•œåƒä»“åº“

GitHub Actions æ„å»ºå¤±è´¥çš„ä¸»è¦åŸå› æ˜¯ **é˜¿é‡Œäº‘é•œåƒä»“åº“ä¸å­˜åœ¨**ã€‚è¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

---

## ğŸ“ è¯¦ç»†æ“ä½œæ­¥éª¤

### 1. ç™»å½•é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡

è®¿é—®ï¼šhttps://cr.console.aliyun.com/

é€‰æ‹© **ä¸Šæµ·** åŒºåŸŸï¼ˆå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ `registry.cn-shanghai.aliyuncs.com`ï¼‰

### 2. åˆ›å»º/ç¡®è®¤å‘½åç©ºé—´

1. åœ¨å·¦ä¾§èœå•é€‰æ‹© **ä¸ªäººå®ä¾‹** â†’ **å‘½åç©ºé—´**
2. æŸ¥çœ‹æ˜¯å¦å­˜åœ¨å‘½åç©ºé—´ `zywdockers`
3. å¦‚æœä¸å­˜åœ¨ï¼Œç‚¹å‡» **åˆ›å»ºå‘½åç©ºé—´**ï¼š
   - å‘½åç©ºé—´åç§°ï¼š`zywdockers`
   - è‡ªåŠ¨åˆ›å»ºä»“åº“ï¼šå¼€å¯ï¼ˆæ¨èï¼‰
   - é»˜è®¤ä»“åº“ç±»å‹ï¼šç§æœ‰

### 3. åˆ›å»ºé•œåƒä»“åº“ï¼ˆæ–¹å¼ä¸€ï¼šæ‰‹åŠ¨åˆ›å»ºï¼‰

#### åˆ›å»º Backend ä»“åº“

1. ç‚¹å‡» **é•œåƒä»“åº“** â†’ **åˆ›å»ºé•œåƒä»“åº“**
2. å¡«å†™ä¿¡æ¯ï¼š
   - **å‘½åç©ºé—´**ï¼šé€‰æ‹© `zywdockers`
   - **ä»“åº“åç§°**ï¼š`images/qunkong-backend`
   - **ä»“åº“ç±»å‹**ï¼šç§æœ‰ï¼ˆæ¨èï¼‰
   - **æ‘˜è¦**ï¼šQunkong åç«¯æœåŠ¡é•œåƒ
   - **ä»£ç æº**ï¼šæœ¬åœ°ä»“åº“
3. ç‚¹å‡» **ä¸‹ä¸€æ­¥** â†’ **åˆ›å»ºé•œåƒä»“åº“**

#### åˆ›å»º Frontend ä»“åº“

é‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œä»“åº“åç§°æ”¹ä¸ºï¼š`images/qunkong-frontend`

### 4. åˆ›å»ºé•œåƒä»“åº“ï¼ˆæ–¹å¼äºŒï¼šç®€åŒ–å‘½åï¼‰

å¦‚æœæ‚¨ä¸æƒ³ä½¿ç”¨ `images/` å‰ç¼€ï¼Œå¯ä»¥ç®€åŒ–ä¸ºï¼š

1. åˆ›å»ºä»“åº“ï¼š`qunkong-backend`
2. åˆ›å»ºä»“åº“ï¼š`qunkong-frontend`

ç„¶åä¿®æ”¹ GitHub Actions é…ç½®æ–‡ä»¶ï¼š

ç¼–è¾‘ `.github/workflows/docker-build.yml`ï¼š

```yaml
env:
  REGISTRY: registry.cn-shanghai.aliyuncs.com
  NAMESPACE: zywdockers  # æ”¹ä¸ºåªæœ‰å‘½åç©ºé—´
  BACKEND_IMAGE: qunkong-backend
  FRONTEND_IMAGE: qunkong-frontend
```

### 5. éªŒè¯ä»“åº“åˆ›å»ºæˆåŠŸ

åœ¨ **é•œåƒä»“åº“** åˆ—è¡¨ä¸­ï¼Œæ‚¨åº”è¯¥çœ‹åˆ°ï¼š
- `zywdockers/images/qunkong-backend` æˆ– `zywdockers/qunkong-backend`
- `zywdockers/images/qunkong-frontend` æˆ– `zywdockers/qunkong-frontend`

ç‚¹å‡»ä»“åº“åç§°ï¼Œå¯ä»¥çœ‹åˆ°ï¼š
- **åŸºæœ¬ä¿¡æ¯**ï¼šä»“åº“åœ°å€ã€æ‹‰å–å‘½ä»¤
- **æ“ä½œæŒ‡å—**ï¼šæ¨é€é•œåƒçš„å‘½ä»¤ç¤ºä¾‹

---

## ğŸ”‘ éªŒè¯è®¿é—®å‡­è¯

### æ£€æŸ¥è®¿é—®å‡­è¯

1. åœ¨é˜¿é‡Œäº‘æ§åˆ¶å°ï¼Œç‚¹å‡»å³ä¸Šè§’ç”¨æˆ·å
2. é€‰æ‹© **è®¿é—®å‡­è¯** â†’ **å®¹å™¨é•œåƒæœåŠ¡**
3. æŸ¥çœ‹æˆ–é‡ç½® **å›ºå®šå¯†ç **
4. ç¡®è®¤ç”¨æˆ·åæ˜¯ `youwei886`

### æ›´æ–° GitHub Secretsï¼ˆå¦‚æœå¯†ç ä¸å¯¹ï¼‰

å¦‚æœå¯†ç ä¸æ˜¯ `zhangyouwei886123`ï¼Œéœ€è¦æ›´æ–° GitHub Secretsï¼š

1. è®¿é—®ï¼šhttps://github.com/ZYWNB666/qunkong/settings/secrets/actions
2. æ‰¾åˆ° `ALIYUN_PASSWORD`
3. ç‚¹å‡» **Update** æ›´æ–°ä¸ºæ­£ç¡®çš„å¯†ç 

---

## âœ… å®Œæˆé…ç½®å

### æ–¹å¼ä¸€ï¼šç­‰å¾…è‡ªåŠ¨æ„å»º

ä»£ç å·²æ¨é€ï¼ŒGitHub Actions ä¼šè‡ªåŠ¨è§¦å‘æ–°çš„æ„å»ºã€‚

è®¿é—®æŸ¥çœ‹çŠ¶æ€ï¼šhttps://github.com/ZYWNB666/qunkong/actions

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨è§¦å‘æ„å»º

1. è®¿é—®ï¼šhttps://github.com/ZYWNB666/qunkong/actions
2. é€‰æ‹© **Build and Push Docker Images** å·¥ä½œæµ
3. ç‚¹å‡» **Run workflow** ä¸‹æ‹‰èœå•
4. é€‰æ‹© `main` åˆ†æ”¯
5. ç‚¹å‡»ç»¿è‰²çš„ **Run workflow** æŒ‰é’®

---

## ğŸ“Š éªŒè¯æ„å»ºæˆåŠŸ

æ„å»ºæˆåŠŸåï¼Œæ‚¨åº”è¯¥çœ‹åˆ°ï¼š

1. âœ… **Build Backend Image** - ç»¿è‰²å¯¹å‹¾
2. âœ… **Build Frontend Image** - ç»¿è‰²å¯¹å‹¾

åœ¨é˜¿é‡Œäº‘é•œåƒä»“åº“ä¸­ï¼Œå¯ä»¥çœ‹åˆ°æ–°æ¨é€çš„é•œåƒæ ‡ç­¾ï¼š
- `latest`
- `main`
- `main-<commit-sha>`

---

## ğŸ› å¦‚æœä»ç„¶å¤±è´¥

### æ£€æŸ¥æƒé™é”™è¯¯

å¦‚æœä»æç¤º `insufficient_scope: authorization failed`ï¼š

1. ç¡®è®¤é˜¿é‡Œäº‘è´¦å·å·²å¼€é€šå®¹å™¨é•œåƒæœåŠ¡
2. ç¡®è®¤å‘½åç©ºé—´å’Œä»“åº“å·²åˆ›å»º
3. ç¡®è®¤ GitHub Secrets ä¸­çš„ç”¨æˆ·åå¯†ç æ­£ç¡®
4. å°è¯•åœ¨æœ¬åœ°æ‰‹åŠ¨æ¨é€æµ‹è¯•ï¼š

```bash
# ç™»å½•
docker login --username=youwei886 --password=ä½ çš„å¯†ç  registry.cn-shanghai.aliyuncs.com

# æ„å»ºæµ‹è¯•é•œåƒ
docker build -f Dockerfile.backend -t registry.cn-shanghai.aliyuncs.com/zywdockers/images/qunkong-backend:test .

# æ¨é€æµ‹è¯•
docker push registry.cn-shanghai.aliyuncs.com/zywdockers/images/qunkong-backend:test
```

å¦‚æœæœ¬åœ°æ¨é€æˆåŠŸï¼Œè¯´æ˜æ˜¯ GitHub Secrets é…ç½®é—®é¢˜ã€‚

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. æ£€æŸ¥é˜¿é‡Œäº‘æ§åˆ¶å°é”™è¯¯æ—¥å¿—
2. æŸ¥çœ‹ GitHub Actions è¯¦ç»†æ—¥å¿—
3. ç¡®è®¤å‘½åç©ºé—´ã€ä»“åº“åç§°ã€å¯†ç éƒ½æ­£ç¡®
4. å°è¯•é‡ç½®é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡å¯†ç 

é…ç½®å®Œæˆåï¼Œé•œåƒä¼šè‡ªåŠ¨æ„å»ºå¹¶æ¨é€åˆ°é˜¿é‡Œäº‘ï¼

